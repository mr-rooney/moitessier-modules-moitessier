//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////
///////////// INCLUDES
//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////

#include "crc.h"


//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////
///////////// LOCAL DEFINES
//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////

#define CRC_POLY 0x1021

//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////
///////////// STATIC FUNCTION PROTOTYPES
//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////

/* ... */

//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////
///////////// GLOBAL LOCAL VARIABLES
//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////

/* ... */

//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////
///////////// INTERRUPT SERVICE ROUTINES
//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////

/* ... */

//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////
///////////// STATIC FUNCTIONS
//////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////

uint32_t CRC_calc(uint8_t dat, uint32_t crc, uint8_t bitCnt)
{
	uint8_t cnt_bits;
	uint8_t flag_xor;
	uint8_t bitsToProcess = 8;
	
	if(bitCnt % 8)
	{
	    dat <<= (8 - bitCnt);
	    bitsToProcess = bitCnt;
	}
	    
	for(cnt_bits = bitsToProcess; cnt_bits > 0; cnt_bits--)
	{
	 	flag_xor = ((crc >> 8) & 0x80) ^ (dat & 0x80);
		dat <<= 1;
		crc <<= 1;
		if (flag_xor) 
		    crc ^= CRC_POLY;
	}
	return(crc);
}

void CRC_init(uint32_t *crc)
{
	*crc = 0xFFFFFFFF;	
}
